{% extends "base.html" %} {% load staticfiles %} {% block content %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="{% static 'js/editableTableWidget.js'%}"></script>
<script src="{% static 'js/tabletojson.js'%}"></script>
<script src="{% static 'js/update_table.js'%}"></script>
<div class="container">
    <h1> Index </h1>
    <div class="row">
    <div class="col-md-6">
        <table id="table" class="table">
            <thead class="thead-inverse">
                <tr>
                    <th class="text-center">X[0]</th>
                    <th class="text-center">X[1]</th>
                    <th class="text-center">X[2]</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="text-center">1</td>
                    <td class="text-center">2</td>
                    <td class="text-center">3</td>
                </tr>
                <tr>
                    <td class="text-center">1</td>
                    <td class="text-center">2</td>
                    <td class="text-center">0</td>
                </tr>
                <tr>
                    <td class="text-center">3</td>
                    <td class="text-center">4</td>
                    <td class="text-center">5</td>
                </tr>
                <tr>
                    <td class="text-center">4</td>
                    <td class="text-center">5</td>
                    <td class="text-center">0</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col-md-6">
        <table class="table">
            <thead class="thead-inverse">
                <tr>
                    <th colspan="5" class="text-center">Predicted values</th>
                </tr>
            </thead>
            <tbody id="PredTable">
                <tr>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                </tr>
                <tr>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                </tr>
                <tr>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                </tr>
                <tr>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                    <td class="text-center">0</td>
                </tr>
            </tbody>
        </table>
    </div>
  </div>
    <div class="col-md-6">
        <table class="table">
            <thead class="thead-inverse">
                <tr>
                    <th colspan="5" class="text-center">Table W (Weights)</th>
                </tr>
            </thead>
            <tbody id="WTable">

            </tbody>
        </table>
    </div>
    <div class="col-md-6">
        <table class="table">
            <thead class="thead-inverse">
                <tr>
                    <th colspan="5" class="text-center">Table H (Features)</th>
                </tr>
            </thead>
            <tbody id="HTable">

            </tbody>
        </table>
    </div>

    <div class="col-md-4 col-md-offset-4">
        <div class="col-xs-6">
            <div class="form-group">
                <label for="R">Number of features:</label>
                <select class="form-control" id="R">
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                </select>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label for="eC">Minimum error:</label>
                <select class="form-control" id="eC">
                  <option>1</option>
                  <option>0.1</option>
                  <option>0.01</option>
                  <option>0.001</option>
                  <option>0.0001</option>
                </select>
            </div>
        </div>
        <div class="col-xs-4 col-xs-offset-4">
            <button id="fit-predict" class="btn btn-lg btn-success" onclick="predict()">Predict!</button>
        </div>
    </div>

</div>
</div>
<script>
    $('#table').editableTableWidget();
    $('table td').on('validate', function(evt, newValue) {
        if (newValue > 10 || isNaN(newValue) || newValue < 0 || newValue == "") {
            return false; // mark cell as invalid
        };
    });

    function predict() {
        var table = $('#table').tableToJSON();
        var features = $('#R option:selected').text();
        var eC = $('#eC option:selected').text();
        $('#fit-predict').prop('disabled', true);
        $('#fit-predict').text("Predicting...");
        data = {
            "data": JSON.stringify(table),
            "R": features,
            "eC": eC,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
        $.ajax({
            type: "POST",
            url: "/fit-predict/",
            data: data,
            success: function(resp) {
                $('#fit-predict').prop('disabled', false);
                $('#fit-predict').text("Predict!");
                update_table("#PredTable", resp['data']);
                update_table("#HTable", resp['H']);
                update_table("#WTable", resp['W']);
            },
            dataType: "json"
        });
    };
</script>
{% endblock %}
